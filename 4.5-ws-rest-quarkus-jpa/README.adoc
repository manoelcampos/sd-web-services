:source-highlighter: highlightjs
:numbered:

ifdef::env-github[]
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]

= Exemplo de Aplica√ß√£o REST utilizando Java com JAX-RS, CDI, JPA e o framework Quarkus (link:https://kinolien.github.io/gitzip/?download=/manoelcampos/sd-webservices/tree/master/4.5-ws-rest-quarkus-jpa[zip])

Este projeto usa o framework https://quarkus.io[Quakus] para compilar e executar uma aplica√ß√£o
java web que disponibiliza servi√ßos REST utilizando a API JAX-RS.

O Quarkus √© o que h√° de mais recente e moderno para o desenvolvimento e execu√ß√£o
de  aplica√ß√µes Jakarta EE (antigo Java EE).
Ele permite compilar o c√≥digo Java para c√≥digo nativo usando a https://graalvm.org[GraalVM]
no lugar da JVM. A GraalVM √© tamb√©m um projeto recente que permite compilar aplica√ß√µes em uma infinidade de linguagens para c√≥digo nativo. A lista de linguagens √© extensa e inclui JavaScript (e Node.js), Python, Ruby, Java, Scala, Groovy, Kotlin, etc.

O projeto inclui acesso √† banco de dados com a Java Persistence API (JPA) utilizando o framework Hibernate
por meio da biblioteca https://quarkus.io/guides/hibernate-orm-panache[Panache].
Tal biblioteca praticamente elimina a necessidade de criarmos DAOs para implementar o acesso ao BD,
al√©m de reduzir drasticamente a quantidade de c√≥digo das classes de neg√≥cio.
Veja a documenta√ß√£o das classes no pacote `model` para mais detalhes.

== Requisitos

=== Ferramentas

O projeto requer JDK 8 ou 11 e Maven 3.6.3 ou superior.
Mesmo as vers√µes mais atuais do NetBeans v√™m com vers√µes antigas do Maven que n√£o ir√° funcionar.

O maven pode ser instalado, por exemplo em distribui√ß√µes Linux baseadas em Debian, com:

[source,bash]
----
sudo apt-get install maven
----

No Windows, pode-se baixar um arquivo `apache-maven-x.x.x-bin.zip` em https://maven.apache.org/download.cgi. Voc√™ tamb√©m pode configurar o https://docs.microsoft.com/en-us/windows/wsl/install-win10[Windows Subsystem for Linux] e assim poder√° baixar aplica√ß√µes usando o mesmo comando Linux acima.

No NetBeans ent√£o √© poss√≠vel indicar que deseja-se utilizar uma vers√£o do Maven instalada no sistema, no lugar de usar a que vem com o NetBeans. 
Para isto, acesse as prefer√™ncias do NetBeans, depois a aba Java >> Maven e informe o caminho do comando "mvn" no campo "Maven Home".

=== Banco de Dados

O projeto usa um banco de dados em mem√≥ria do Apache H2, recriando e populando o banco a cada vez que a aplica√ß√£o √© iniciada.
No entanto, voc√™ pode utilizar qualquer banco que desejar, desde que fa√ßa as configura√ß√µes adequadas para o banco escolhido. Para isto, √© preciso incluir o driver JDBC para o seu banco a partir das depend√™ncias do Quarkus no pom.xml. 

As configura√ß√µes da conex√£o devem ser definidas no arquivo link:src/main/resources/application.properties[application.properties].

== Cria√ß√£o do Projeto

Toda a estrutura deste projeto foi criada automaticamente. A forma mais f√°cil de fazer isso √© por meio do site http://code.quarkus.io. Assim, tal site pode ser o ponto de partida para a cria√ß√£o de novos projetos.


== Detalhes do Projeto

As configura√ß√µes do DataSource para conex√£o com o banco foram feitas no arquivo link:src/main/resources/application.properties[application.properties] e n√£o no persistence.xml. Apesar de ser poss√≠vel utilizar o persistence.xml como usual, voc√™ n√£o pode incluir os dois arquivos no projeto. De qualuqer forma, a configura√ß√£o pelo application.properties √© muito mais simples.

Veja que como o servidor ser√° embutido na nossa aplica√ß√£o, precisamos indicar qual o banco de dados ser√° usado, inclu√≠ndo uma depend√™ncia para isso no pom.xml. Neste caso o banco de dados usado foi o Apache H2 em mem√≥ria. Assim foi inclu√≠da a depend√™ncia `quarkus-jdbc-h2`. 

Por fim, que as depend√™ncias que normalmente inclu√≠mos em um projeto JavaEE com Hibernate seriam javax.javaee-web-api, org.hibernate.javax.persistence e possivelmente outras depend√™ncias relacionadas a API JAX-RS e processamento de JSON. Ao usar um framework como o Quarkus que embute um servidor na pr√≥pria aplica√ß√£o, tais depend√™ncias n√£o devem ser inclu√≠das do modo tradicional (usando os pacotes fornecidos pelo desenvolvedor destas bibliotecas), mas sim as vers√µes de tais bibliotecas disponibilizadas por ferramentas como o Quarkus.

Assim, veja que no link:pom.xml[pom.xml] que tais bibliotecas usadas foram fornecidas pelo pr√≥prio Quarkus.

== Executar o Projeto

=== Ambiente de Desenvolvimento 

Voc√™ pode iniciar o servidor com sua aplica√ß√£o de diferentes maneiras.

==== Usando Maven pela linha de comando

```bash
mvn compile quarkus:dev
```

==== Usando o maven-exec-plugin

Voc√™ pode clicar no bot√£o Play em IDEs como o NetBeans, pois foi inclu√≠do o plugin maven-exec para executar o comando acima mais facilmente.
Caso voc√™ esteja criando o projeto do zero, o plugin maven-exec n√£o ser√° inclu√≠do
e voc√™ deve inclu√≠-lo dentro da tag `<plugins>` no arquivo pom.xml, como
mostrado abaixo:

```xml
<plugin>
  <groupId>org.codehaus.mojo</groupId>
  <artifactId>exec-maven-plugin</artifactId>
  <version>1.6.0</version>
  <configuration>
    <executable>mvn</executable>
    <arguments>
      <argument>clean</argument>
      <argument>compile</argument>
      <argument>quarkus:dev</argument>
    </arguments>
  </configuration>
</plugin>
```

==== Atualizando o projeto sem reiniciar o servidor

Bem, atualizar o projeto no servidor em execu√ß√£o e ver as altera√ß√µes que voc√™ fez na sua aplica√ß√£o √© realmente complicado com o Quarkus: voc√™ precisa apenas salvar o projeto e boom: normalmente em menos de 1 segundo a aplica√ß√£o estar√° rodando com as novas altera√ß√µes üò±üöÄüòÅ.

N√£o √© √† toa que o slogan do Quarkus √© "Supersonic Subatomic Java".

==== Acessando a aplica√ß√£o

Se voc√™ estiver habituado a usar servidores como o GlassFish no NetBeans, sabe que ao clicar no bot√£o Play, o projeto √© compilado e executado, abrindo o navegador automaticamente.
Usando o Quarkus isso n√£o ocorrer√°.
Voc√™ deve abrir o navegador voc√™ mesmo. Neste caso, a aplica√ß√£o estar√° dispon√≠vel
em http://localhost:8080. Observe que n√£o h√° um caminho adicional com o nome da aplica√ß√£o no final da URL, pois a aplica√ß√£o executa na raiz do servidor.

=== Ambiente de Produ√ß√£o

Para enviar a aplica√ß√£o para um ambiente de produ√ß√£o voc√™ deve executar `./mvnw clean package` em um terminal na raiz do projeto para criar o que chamamos de uber jar. Este √© um tipo de jar que cont√©m tudo que a aplica√ß√£o precisa para executar:

- a pr√≥pria aplica√ß√£o;
- o servidor que executar√° a aplica√ß√£o;
- todas as depend√™ncias necess√°rias (arquivos jar das bibliotecas usadas).

Com o comando acima o pacote `target/rest-app-quarkus-server-jpa-runner.jar` √© criado e a partir dele podemos iniciar o servidor com a aplica√ß√£o. Assim, este √© o *√∫nico* pacote que precisa ser enviado para o ambiente de produ√ß√£o. 

Para executar a aplica√ß√£o em ambiente de produ√ß√£o, basta o comando a seguir:

[source,bash]
----
java -jar rest-app-quarkus-server-jpa-runner.jar
----

Ao rodar a aplica√ß√£o agora, ela vai entender que est√° no ambiente de produ√ß√£o e usar poss√≠veis configura√ß√µes de tal ambiente a partir do arquivo application.properties.

==== Container Docker

Para gerar containers com tudo necess√°rio para executar a aplica√ß√£o, e assim facilitar a implanta√ß√£o (deploy) dela, veja esta link:docker-container.adoc[p√°gina]. 

=== Implantando Aplica√ß√£o no Amazon Web Services (AWS)

Uma breve lista de comandos para conectar aos servi√ßos AWS e implantar
a aplica√ß√£o √© mostrada nesta link:aws.adoc[p√°gina].

== Refer√™ncias

- https://quarkus.io
- https://quarkus.io/guides/getting-started-guide
- https://quarkus.io/guides/building-native-image-guide
- https://quarkus.io/guides/rest-json-guide
- https://lordofthejars.github.io/quarkus-cheat-sheet/
- https://quarkus.io/guides/application-configuration-guide