<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="por Manoel Campos da Silva Filho">
<title>Desenvolvimento Web Services REST em Java utilizando JAX-RS com JPA e CDI no NetBeans (zip)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Desenvolvimento Web Services REST em Java utilizando JAX-RS com JPA e CDI no NetBeans (<a href="https://kinolien.github.io/gitzip/?download=/manoelcampos/sd-webservices/tree/master/4.4-ws-rest-cadastro">zip</a>)</h1>
<div class="details">
<span id="author" class="author">por Manoel Campos da Silva Filho</span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>REST se tornou o padrão de fato para o desenvolvimento de Web Services (WS&#8217;s) há alguns anos, em oposição ao protocolo SOAP padronizado pela W3C.
Isto se deve a diversos fatores como:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Troca de mensagens simplificadas entre cliente e servidor, normalmente utilizando JSON no lugar de XML. Isto faz com o tráfego de dados e o delay causado pela troca de mensagens sejam reduzidos. Tais características são fundamentais para dispositivos móveis que normalmente possuem pacotes de dados com tráfego e velocidade limitados.</p>
</li>
<li>
<p>Utilização apenas dos recursos do protocolo HTTP para troca de mensagens, sem precisar empacotar os dados da requisição no cabeçalho de outro protocolo como o SOAP, que apenas aumenta o tamanho dos pacotes de dados sendo enviados.</p>
</li>
<li>
<p>Utilização de URLs convencionalmente amigáveis, tornando muito simples o teste de clientes REST utilizando ferramentas de linha de comando como curl ou outras como plugins para navegadores.</p>
</li>
<li>
<p>Ampla adoção pelo mercado, tornando-o um padrão de fato, amplamente suportado pela comunidade de software livre com a disponibilização de inúmeras bibliotecas e suporte nos mais conhecidos IDEs do mercado.</p>
</li>
<li>
<p>Grandes empresas como Google, Facebook, Twitter, Yahoo e muitas outras fornecem incontáveis serviços REST para as mais variadas finalidades. Tais WS&#8217;s fornecem desde integração com serviços como Google Maps, YouTube e Google Translator, informações sobre previsão do tempo e cotação de moedas (inclusive de criptomoedas como Bitcoin), etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por estes motivos, SOAP se tornou absoleto, dando lugar ao REST. Desta forma, neste tutorial será mostrado o desenvolvimento de uma aplicação servidora e outra cliente utilizando o padrão REST. Será mostrado um passo-a-passo para criar as aplicações do zero, explicando as tecnologias utilizadas e configurações necessárias. Então vamos lá.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ferramentas_necessárias">1. Ferramentas Necessárias</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para este projeto vamos utilizar as seguintes ferramentas:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JDK 1.8 (a maioria dos servidores de aplicação ainda não suporta versões mais recentes do JDK)</p>
</li>
<li>
<p><a href="http://netbeans.apache.org">IDE NetBeans 11</a></p>
</li>
<li>
<p>Servidor de aplicação GlassFish 5 (a ser mostrado como instalar)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Considera-se que você já tem os itens 1 e 2 previamente instalados.</p>
</div>
<div class="sect2">
<h3 id="_mysql_server">1.1. MySQL Server</h3>
<div class="paragraph">
<p>Nossa aplicação servidora utilizará um banco de dados MySQL, apesar que qualquer outro banco pode ser utilizado. Se estiver utilizando Linux, como Ubuntu, basta fazer o download do MySQL Server via apt-get com o comando abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">sudo apt-get install mysql-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se estiver usando Windows ou macOS, pode baixar o instalador do
MySQL Server Community <a href="https://dev.mysql.com/downloads/mysql/">aqui</a>.
Certifique-se de conferir qual a versão do MySQL está sendo baixada,
pois existem diferenças de configuração para as versões 5 e 8 que serão discutidas adiante.
No Linux, basta digitar <code>mysql --version</code> no terminal.</p>
</div>
<div class="sect3">
<h4 id="_criando_o_banco_de_dados">1.1.1. Criando o Banco de Dados</h4>
<div class="paragraph">
<p>Utilize o NetBeans para criar o banco de dados chamado <code>cadastro-rest</code> para o nosso sistema, acessando a aba "Services".</p>
</div>
<div class="paragraph">
<p>O processo é mostrado no vídeo a seguir.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="800" height="600" src="https://www.youtube.com/embed/g0R11_1Fv1I?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Não precisaremos criar as tabelas manualmente, como veremos a seguir.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_glassfish_5">1.2. GlassFish 5</h3>
<div class="paragraph">
<p>Vamos utilizar o GlassFish 5 por ser a última versão até o momento de elaboração deste tutorial.</p>
</div>
<div class="paragraph">
<p>O vídeo a seguir mostra os passos para instalar o GlassFish 5.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="800" height="600" src="https://www.youtube.com/embed/_Af4RK9UvRw?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>Como vamos usar o MySQL como banco de dados, precisaremos do MySQL Connector J, driver JBDC do MySQL (que vai ser utilizado internamente para acesso ao BD). Baixe o driver no <a href="https://dev.mysql.com/downloads/connector/j/">site oficial</a>.</p>
</div>
<div class="paragraph">
<p>Após descompactar o driver, o único arquivo que nos interessa é o <code>mysql-connector-java-X.X.X-bin.jar</code> (onde X.X.X é a versão do driver). Copie tal arquivo para a pasta <code>glassfish5/glassfish/domains/domain1/lib</code> (considerando que <code>glassfish5</code> é a pasta onde descompactou o GlassFish). As bibliotecas colocadas em tal pasta serão carregadas automaticamente pelo GlassFish.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_estrutura_do_projeto">2. Estrutura do projeto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Utilizaremos o <a href="https://pt.wikipedia.org/wiki/Hibernate">Hibernate</a> como framework de <a href="https://pt.wikipedia.org/wiki/Mapeamento_objeto-relacional">mapeamento objeto relacional (Object Relational Mapping - ORM)</a>, que é uma implementação da especificação <a href="https://pt.wikipedia.org/wiki/Java_Persistence_API">JPA</a>. Ele nos permite "esquecer" os detalhes de BDs relacionais (como SQL, Primary Keys (PKs), Foreign Keys (FKs), criação de tabelas, etc) e assim podermos trabalhar exclusivamente em um modelo orientado a objetos, mesmo para manipulação dos dados no banco.</p>
</div>
<div class="paragraph">
<p>A especificação <a href="http://cdi-spec.org">Context and Dependency Injection (CDI)</a> permite que objetos sejam injetados (ou seja, criados automaticamente) onde precisarmos. Tal especificação é implementada por padrão em servidores de aplicação como o GlassFish ou WildFly.</p>
</div>
<div class="paragraph">
<p>CDI permite diminuir o acoplamento de um software, ou seja, reduz o nível de dependência do nosso projeto. Por exemplo, a partir do momento que utilizamos a especificação JPA como camada de persistência (para salvarmos os dados em algum lugar, neste caso em um BD), se instanciarmos diretamente no nosso código objetos JPA para fazer tais operações, estamos aumentando o nível de dependência do nosso projeto, tornando ele fortemente dependente da JPA. Se precisamos, por exemplo, persistir certos objetos em outro repositório, como em arquivos no disco, precisaríamos instanciar explicitamente objetos diferentes para realizar tal tarefa.</p>
</div>
<div class="paragraph">
<p>Com CDI, podemos simplesmente declarar um objeto e indicar que queremos que uma instância de tal objeto seja injetada automaticamente quando tal objeto precisar ser usado. Com isto, podemos ter um arquivo de configuração separado que define qual instância será injetada quando um objeto de um determinado tipo for solicitado. Se precisarmos mudar o tipo de objeto (como objetos que usam JPA para persistir dados em um BD por objetos que simplesmente salvam dados em um arquivo), podemos alterar isso em apenas um lugar do código. Observe que utilizei o termo "tipo" e não "classe", uma vez que este tipo pode ser tanto uma classe quanto uma interface, sendo interfaces comumente mais utilizadas.</p>
</div>
<div class="paragraph">
<p>O CDI também nos livra de termos que utilizar o operador <code>new</code> sempre que precisarmos usar um deteminado objeto.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o_projeto">3. O projeto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O projeto que desenvolveremos será bem simples. O diagrama de classe abaixo mostra que teremos apenas duas classes de negócio <code>Usuario</code> e <code>Cidade</code>. O servidor disponibilizará um cadastro de usuários por meio de um Web Service REST. A classe <code>Usuario</code> tem apenas dados básicos e mais um atributo que indica a cidade onde ele mora.</p>
</div>
<div class="paragraph">
<p>Existe uma interface <code>Cadastro</code> que será implementada por todas as classes que representarem tabelas no BD. Tal interface apenas define  um getter e setter para um atributo <code>id</code> que cada classe de negócio terá. Assim, estamos definindo que todas essas classes devem ter um atributo <code>id</code>, que será bastante útil posteriormente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/class-diagram.jpg" alt="class diagram">
</div>
<div class="title">Figure 1. Diagrama das Classes de Negócio</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_iniciando_o_desenvolvimento">4. Iniciando o Desenvolvimento</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vamos criar um projeto Maven de uma Web Application no NetBeans, como mostra a animação abaixo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-project.gif" alt="create project">
</div>
</div>
<div class="paragraph">
<p>O campo <code>groupId</code> na penúltima tela de criação do projeto foi preenchido com <code>com.manoelcampos</code> indicando um nome de domínio invertido para identificar a empresa ou pessoa que desenvolveu o projeto. Caso você tenha um domínio, pode utilizar. Caso não tenho, pode inventar um ou usar qualquer nome que desejar. O campo <code>package</code> é automaticamente formado pela junção do <code>groupId</code> com o nome dado para o projeto no primeiro campo.</p>
</div>
<div class="paragraph">
<p>Se nunca utilizou Maven antes, esta é uma ferramenta para gerenciamento de dependências no seu projeto, permitindo baixar as dependências indicadas automaticamente. Não confunda com o CDI que usaremos para injeção de dependências. No Maven dizemos quais bibliotecas nosso projeto precisa. Usando CDI, dizemos quais objetos devem ser injetados (automaticamente instanciados) quando precisarmos deles.</p>
</div>
<div class="sect2">
<h3 id="_criando_as_classes_de_negócio">4.1. Criando as classes de negócio</h3>
<div class="paragraph">
<p>Agora vamos criar as classes <code>Usuario</code> e <code>Cidade</code>. Primeiro vamos criar a classe <code>Usuario</code> dentro de um subpacote chamado <code>model</code>, onde colocaremos todas as classes de negócio (que representam o modelo do negócio).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-business-class.gif" alt="create business class">
</div>
</div>
<div class="paragraph">
<p>Veja que apenas adicionamos <code>.model</code> ao final do nome do pacote ao criar a classe. Agora crie a classe <code>Cidade</code> dentro deste pacote <code>model</code>.</p>
</div>
<div class="paragraph">
<p>Como tais classes representarão tabelas no BD, cada uma delas deve ter um atributo <code>id</code> (neste caso, este id representa uma chave primária simples). Para isso, vamos criar uma interface chamada <code>Cadastro</code> que define métodos getter e setter para este atributo de tais classes. Tal interface ficará no mesmo pacote das classes e terá o seguinte código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public interface Cadastro {
    long getId();
    void setId(long id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos então indicar que nossas classes <code>Usuario</code> e <code>Cidade</code> implementam tal interface.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/implement-interface-methods.gif" alt="implement interface methods">
</div>
</div>
<div class="paragraph">
<p>Como estas classes agora precisam implementar os métodos na interface, podemos usar o NetBeans para incluir o corpo dos métodos pra nós, como mostrado acima. Faça o mesmo para as duas classes de negócio.</p>
</div>
<div class="paragraph">
<p>Nossa classe <code>Usuario</code> terá apenas os atributos abaixo, com os respectivos getters e setters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    private long id;
    private String nome;
    private String cpf;

    @ManyToOne
    private Cidade cidade;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observe que na classe <code>Usuario</code> temos um atributo do tipo <code>Cidade</code>. Isto representa um relacionamento entre as duas classes. Neste caso, a cardinalidade da associação entre <code>Usuario</code> e <code>Cidade</code> (nesta direção) é n..1, ou seja, muitos usuários são de uma mesma cidade. Para representar tal associação precisamos usar a anotação <code>@ManyToOne</code> no atributo. Desta forma, no banco de dados será criada uma chave estrangeira dentro da tabela <code>Usuario</code> para armazenar o id da <code>Cidade</code>.</p>
</div>
<div class="paragraph">
<p>Podemos usar o NetBeans para criar tais métodos para gente. Temos apenas que apagar o código gerado para os métodos <code>getId()</code> e <code>setId()</code> e definir o código apropriado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/encapsulating-fields.gif" alt="encapsulating fields">
</div>
</div>
<div class="paragraph">
<p>Faça o mesmo para a classe <code>Cidade</code>, definindo os atributos abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    private long id;
    private String nome;
    private String uf;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_utilizando_a_jpa_para_acesso_ao_banco_de_dados">4.2. Utilizando a JPA para acesso ao Banco de Dados</h3>
<div class="paragraph">
<p>Como falado, a JPA é uma especificação Java que provê uma forma padrão para a implementação de frameworks de ORM como o Hibernate. Assim, se usarmos JPA, podemos trocar o framework por qualquer outro que implementa tal especificação, sem precisarmos alterar nosso código fonte (apenas configurações serão necessárias).</p>
</div>
<div class="paragraph">
<p>Para usarmos a JPA, e posteriormente o Hibernate em segundo plano, para fazer toda a comunicação com o BD, precisamos indicar quais classes representam tabelas no BD. Nossas classes de negócio <code>Usuario</code> e <code>Cidade</code> serão as únicas a serem mapeadas para tabelas no banco (por isso chama-se mapeamento objeto-relacional, pois mapeia-se objetos para um BD relacional como o MySQL).</p>
</div>
<div class="paragraph">
<p>Para indicarmos que uma classe será mapeada, precisamos marcá-la com a anotação <code>@Entity</code> da JPA, definindo a classe como uma entidade (uma tabela no BD). Tal anotação precisa ser colocada imediatamente antes da declaração da classe. Após incluí-la, precisaremos importar tal anotação. Novamente podemos usar o NetBeans para isso, clicando na lâmpada que aparece no lado esquerdo da linha, como mostrado abaixo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/define-entity.gif" alt="define entity">
</div>
</div>
<div class="paragraph">
<p>Observe que após salvarmos, é apresentado um erro na linha da declaração da classe. Passando o mouse no erro destacado em vermelho, podemos ver que está sendo indicado que não há nenhum atributo <code>ID</code> para a entidade. Podemos clicar na lâmpada e usar o NetBeans para definir um <code>ID</code>, como mostra a animação acima.</p>
</div>
<div class="paragraph">
<p>Já temos um atributo que chamamos de <code>id</code> e que representa a identificação única de cada objeto da classe (ou seja, a PK na tabela do BD). Assim, apenas indicamos que queremos usar um campo existente como <code>ID</code> e então selecionamos o campo chamado <code>id</code>. Com isto, uma anotação <code>@Id</code> é colocada no campo.</p>
</div>
<div class="paragraph">
<p>Para indicarmos que desejamos que o valor deste campo seja gerado automaticamente no BD (para que ele seja definido como autoincrement no MySQL), vamos adicionar a anotação <code>@GeneretedValue</code>, indicando que a estatégia para geração do valor do campo será <code>IDENTITY</code>. O atributo <code>id</code> deve ficar como abaixo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private long id;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As classes anotadas com <code>@Entity</code> (que a partir de agora, por simplificação chamaremos apenas de Entity) devem implementar a interface <code>Serializable</code>, indicando que objetos de tais classes podem ser persistidos (salvos). Também podemos usar o NetBeans para fazer essa modificação para nós.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/implement-serializable.gif" alt="implement serializable">
</div>
</div>
<div class="paragraph">
<p>O mesmo processo de definir uma entidade, um <code>ID</code> e implementar <code>Serializable</code> deve ser aplicado para todas as classes de negócio.</p>
</div>
</div>
<div class="sect2">
<h3 id="_definindo_uma_persistence_unit_pu">4.3. Definindo uma Persistence Unit (PU)</h3>
<div class="paragraph">
<p>Projetos utilizando JPA precisam conter uma Persistence Unit (PU), que é uma arquivo chamado <code>persistence.xml</code> definindo as configurações para acesso ao BD, controle de transações, provedor de persistência a ser utilizado e outras configurações. Ele é o arquivo de configuração da JPA.</p>
</div>
<div class="paragraph">
<p>Uma vez que já temos algumas Entities no nosso projeto, podemos facilmente adicionar uma PU utilizando o NetBeans,
como mostra este <a href="https://youtu.be/7y--ODvjdjQ">vídeo</a>.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="800" height="600" src="https://www.youtube.com/embed/7y--ODvjdjQ?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>No vídeo acima, definimos o nome da PU como <code>default</code> (um nome mais simples que o sugerido pelo NetBeans). Como teremos apenas uma PU no nosso projeto (para acessar um único BD), não precisaremos nos preocupar com este nome. Escolhemos o Persistence Provider como Hibernate (JPA 2.1), indicando que o Hibernate será a implementação da JPA que utilizaremos. No campo Data Source devemos escolher ou configurar uma conexão com o BD. Um Data Source (DS) é uma fábrica de conexões com o BD.</p>
</div>
<div class="paragraph">
<p>Temos então que criar primeiro um DS. Chamamos tal DataSource de "cadastro-rest-ds" e selecionamos a conexão com o BD (configurada quando criamos o banco "cadastro-rest"). O nome do DS é utilizado na PU para poder instanciar uma conexão com o banco. Após abrir o arquivo <code>persistence.xml</code> (que representa as configurações da PU), o NetBeans mostra um editor gráfico para tal arquivo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/persistence-unit.png" alt="persistence unit">
</div>
</div>
<div class="paragraph">
<p>Alguns pontos importantes são:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Persistence Provider</strong>: definimos que desejamos usar Hibernate (como dito antes), como implementação da JPA.</p>
</li>
<li>
<p><strong>Use Java Transaction APIs</strong>: esta opção indica que nossa aplicação usará a JTA. Esta é uma API implementada por servidores de aplicação como o GlassFish, para prover controle automático de transações para nossa aplicação. Isto quer dizer que não teremos que nos preocupar em abrir, cancelar ou confirmar transações no BD. Tudo isso será feito automaticamente pelo GlassFish.</p>
</li>
<li>
<p><strong>Table Generation Strategy</strong>: está como "Create" para permitir que, ao rodar a aplicação, as tabelas sejam criadas no BD automaticamente. Depois que elas tiverem sido criadas, podemos alterar para "None". A opção "Drop and Create" só é interessante se não houver dados que desejamos manter no banco. Assim, sempre que exercutarmos a aplicação, as tabelas serão apagadas e recriadas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Há apenas alguns detalhes que precisamos observar. Se clicarmos no botão "Source" na parte superior do arquivo, podemos visualizar todo o código XML gerado. Quando escolhemos o Hibernate, o valor da tag <code>&lt;provider&gt;</code> foi definido como <code>org.hibernate.ejb.HibernatePersistence</code>, porém, tal provider está obsoleto nas versões atuais do Hibernate e deve ser trocado para <code>org.hibernate.jpa.HibernatePersistenceProvider</code>.</p>
</div>
<div class="paragraph">
<p>O provider representa o nome qualificado (incluindo o nome do pacote) da classe que é capaz de criar objetos <code>EntityManagerFactory</code> e a estrutura de tabelas no BD. Um <code>EntityManagerFactory</code> é uma fábrica de objetos <code>EntityManager</code>. Um <code>EntityManager</code> (EM), por sua vez, é responsável por gerenciar o ciclo de vida das entidades como <code>Usuario</code> e <code>Cidade</code> no nosso sistema. Um EM permite, por exemplo, buscar, incluir, alterar e excluir objetos do BD.</p>
</div>
<div class="paragraph">
<p>Por fim, como indicamos que desejamos usar a JTA, da mesma forma que precisamos indicar qual era a classe que implementa o Persistence Provider, precisamos indicar qual a classe que implementa a JTA Platform, responsável por gerenciar as transações no BD.</p>
</div>
<div class="paragraph">
<p>Como estamos utilizando GlassFish, precisamos adicionar na tag <code>&lt;properties&gt;</code> a seguinte propriedade:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;property name="hibernate.transaction.jta.platform" value="org.hibernate.service.jta.platform.internal.SunOneJtaPlatform"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta é a classe do GlassFish que implementa a JTA Platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configurando_o_cdi">4.4. Configurando o CDI</h3>
<div class="paragraph">
<p>Para permitir o uso de CDI, até o JavaEE 6 era obrigatória a existência de um arquivo chamado <code>beans.xml</code>. A partir do JavaEE 7 tal arquivo não é obrigatório, mas podemos criá-lo se quisermos adicionar algumas configurações para o CDI.</p>
</div>
<div class="paragraph">
<p>Pelo menu <code>File &gt;&gt; New File</code> do NetBeans, podemos digitar <code>beans.xml</code> na janela de pesquisa para criar o arquivo. O arquivo possui um atributo chamado <code>bean-discovery-mode</code> que é definido com valor igual a <code>annotated</code>.</p>
</div>
<div class="paragraph">
<p>Isto indica que só podemos injetar objetos que estejam marcados com alguma anotação que define o escopo dos objetos a serem injetados. Algumas anotações de escopo disponibilizadas pelo CDI, que controlam o ciclo de vida de objetos, são o <code>@ApplicationScoped</code> e <code>@RequestScoped</code>. Um objeto marcado com <code>@ApplicationScoped</code> será criado quando requisitado e só será destruído quando a aplicação for finalizada. Um objeto marcado com <code>@RequestScoped</code> será criado sempre que for requisitado e será destruído ao final da requisição. Se não marcarmos um objeto com nenhum anotação de escopo, seu escopo é <code>@Dependent</code>, que indica que seu ciclo de vida depende do ciclo de vida do objeto onde ele foi criado.</p>
</div>
<div class="paragraph">
<p>Para não sermos obrigados a anotar todas as classes que desejamos criar objetos por injeção e assim tornar mais fácil o uso de CDI, podemos alterar o valor do atributo para <code>all</code>. Assim, poderemos injetar objetos de qualquer classe que desejarmos.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Em aplicações com uma grande quantidade de classes, usar <code>bean-discovery-mode=all</code> pode causar <a href="https://weld.cdi-spec.org/news/2016/10/25/tip3-performance/">maior consumo de memória e maior tempo de inicialização</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_adicionando_dependências_maven">4.5. Adicionando dependências Maven</h3>
<div class="paragraph">
<p>O arquivo <code>pom.xml</code> (criando automaticamente quando criamos o projeto Maven) é onde indicamos quais são as dependências do nosso projeto. Como estamos utilizando o Hibernate, precisamos incluir as dependências a seguir dentro da tag <code>&lt;dependencies&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate.javax.persistence&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-jpa-2.1-api&lt;/artifactId&gt;
            &lt;version&gt;1.0.2.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
            &lt;version&gt;5.1.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;
            &lt;version&gt;5.1.0.Final&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O uso de CDI não nos dispensa de declarar as dependências do nosso projeto. O CDI também não vai reduzir o número de dependências. Nosso projeto continua dependendo daquilo que ele usa. O que o CDI garante é que seja fácil trocar a implementação de uma dependência por outra, sem precisar alterar o código, mas somente as configurações como acima.</p>
</div>
<div class="paragraph">
<p>Nosso projeto depende de uma implementação da JPA. Usaremos CDI para injetar objetos que implementam a especificação JPA. Neste caso, tais objetos são de classes implementadas pelo Hibernate, que é o chamado Persistence Provider. Se decidirmos trocar o Hibernate por outra implementação (como o EclipseLink), trocamos apenas as dependências e configurações no <code>persistence.xml</code> e o CDI se encarregará de injetar os objetos criados pelo provider (como o <code>EntityManager</code> discutido anteriormente).</p>
</div>
</div>
<div class="sect2">
<h3 id="_instanciando_um_entitymanager_para_manipular_dados_no_bd">4.6. Instanciando um EntityManager para manipular dados no BD</h3>
<div class="paragraph">
<p>A classe <code>EntityManager</code>, como dito anteriormente, controla o ciclo de vida de Entities (classes de negócio anotadas com <code>@Entity</code>) e permite persistir tais objetos no BD. Para instanciar um <code>EntityManager</code> precisaríamos de um objeto <code>EntityManagerFactory</code> que é uma fábrica de <code>EntityManagers</code>. No entanto, usando CDI, podemos injetar <code>EntityManagers</code> automaticamente, sempre que seu uso for necessário, sem precisarmos recorrer a um <code>EntityManagerFactory</code>.</p>
</div>
<div class="paragraph">
<p>Podemos injetar <code>EntityMangers</code> em classes que tenham o ciclo de vida controlado pelo servidor de aplicação. Para isso, precisaríamos declarar um objeto <code>EntityManager</code> e anotá-lo com <code>@PersistenceContext</code>. Porém, teríamos que utilizar esta anotação em todos os locais onde declarassemos tal objeto. Para não termos que fazer isso e centralizarmos o processo de injeção de qualquer <code>EntityManager</code> em um só lugar, vamos criar uma classe <code>Producers</code> dentro do pacote <code>com.manoelcampos.server.config</code>. A classe e o pacote podem ter qualquer nome que desejar. Esta classe representa um produtor (fábrica) de objetos e usará recursos do CDI para definir como determinados objetos mais complexos, como um <code>EntityManager</code>, devem ser criados. A classe deve ter o código apresentado a seguir:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.manoelcampos.server.config;

import javax.enterprise.inject.Produces;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

public class Producers {
    @Produces
    @PersistenceContext
    private EntityManager em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>O código acima declara um <code>EntityManager</code> (EM) e o anota com <code>@PersistenceContext</code>. Assim, o EM será gerenciado pelo servidor de aplicação (que é chamado de <a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/persistence-intro004.html#BNBQZ">Container-managed EntityManager</a>) e automaticamente injetado quando requisitado, utilizando as configurações definidas no <code>persistence.xml</code>. Como temos apenas uma Persistence Unit (PU) dentro de tal arquivo, não precisamos nos preocupar em definir o nome de tal PU ao anotar o <code>EntityManager</code>. Mas se quisessemos explicitar o nome da PU (que não é recomendável, pois este pode ser renomeado no arquivo xml), poderíamos alterar a anotação para <code>@PersistenceContext(name = "default")</code>, onde <code>default</code> foi o nome que demos pra nossa PU. Mas isso só é aconsolhável se tivermos mais de uma PU no <code>persistence.xml</code>.</p>
</div>
<div class="paragraph">
<p>Observe que o EM também está anotado com <code>@Produces</code>. Isto quer dizer que sempre que precisarmos de um EM, uma instância será criada neste atributo <code>em</code> e retornado para o local onde foi solicitado.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementando_o_padrão_dao">4.7. Implementando o padrão DAO</h3>
<div class="paragraph">
<p>Supondo que estamos desenvolvendo esta aplicação para um determinado cliente, nossas classes de negócio <code>Usuario</code> e <code>Cidade</code> são classes específicas do negócio do cliente. O EM disponibiliza métodos para persistir objetos no BD. Assim, para incluir, alterar ou excluir um objeto no BD, precisamos chamar estes métodos do EM.</p>
</div>
<div class="paragraph">
<p>Para não incluir tal código dentro das classes de negócio (que devem ter apenas código referente ao negócio do cliente), é comum a utilização do padrão <a href="https://pt.wikipedia.org/wiki/Objeto_de_acesso_a_dados">Data Access Object (DAO)</a> para permitir a separação de conceitos (<a href="https://pt.wikipedia.org/wiki/Separação_de_conceitos">Separation of Concerns, SoC</a>). A SoC evita misturar código de um determinado nível de abstração com outros de outro nível. As classes de negócio como <code>Usuario</code> podem ter código para validar o CPF, enquanto operações de BD não estão relacionadas com o negócio e assim devem ser mantidas separadas.</p>
</div>
<div class="paragraph">
<p>Para implementar o padrão DAO, precisaríamos criar uma classe DAO para cada classe de negócio. Assim, teríamos uma classe <code>UsuarioDAO</code> e <code>CidadeDAO</code>. Como um DAO proverá métodos para manipular dados no BD, como <code>salvar</code> e <code>remover</code>, tais métodos acabam ficando duplicados entre os DAOs. Para evitar isso, podemos criar um DAO genérico que funciona para qualquer classe de negócio. Isto pode ter suas desvantagens, mas não vamos discutí-las nesse artigo.</p>
</div>
<div class="paragraph">
<p>Primeiro, vamos definir uma interface chamada DAO, dentro do pacote <code>com.manoelcampos.server.dao</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.manoelcampos.server.dao;

import com.manoelcampos.server.model.Cadastro;

public interface DAO&lt;T extends Cadastro&gt; {
    T findById(long id);
    T findByField(String fieldName, Object value);
    boolean delete(T entity);
    boolean delete(long id);
    long save(T entity);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tal interface define métodos para:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>localizar um objeto no BD a partir do seu id: <code>findById()</code>;</p>
</li>
<li>
<p>localizar por um campo específico: <code>findByField()</code>;</p>
</li>
<li>
<p>remover: <code>delete(T entity)</code> e <code>delte(long id)</code>;</p>
</li>
<li>
<p>e salvar um objeto no BD e retornar o id gerado: <code>save()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A interface usa <a href="https://www.devmedia.com.br/usando-generics-em-java/28981">Generics</a> para permitir indicar qual o tipo de objeto de negócio (que implementa a interface <code>Cadastro</code>) um DAO trabalhará. Assim, quando mandarmos localizar um <code>Usuario</code> utilizando seu id, teremos como retorno um objeto <code>Usuario</code> e não um objeto genérico como <code>Object</code>. Generics é um assunto bem extenso que está fora do escopo deste artigo.</p>
</div>
<div class="paragraph">
<p>Agora que definimos uma interface padrão para nossos DAOs, vamos criar uma classe que utilizará JPA para implementar tal interface. Definir a interface e criar uma classe que a implementa é muito útil se desejarmos criar outras formas de persistência para nossos objetos de negócio. Por exemplo, poderíamos desejar persistir os objetos em um BD usando JPA e também em arquivos, utilizando o recurso de serialização do Java. Para isso, poderíamos ter classes DAO implementando diferentes mecanismos de persistência de dados.</p>
</div>
<div class="paragraph">
<p>Assim, crie a classe <code>JpaDAO</code> no pacote <code>com.manoelcampos.server.dao</code> como abaixo. Ela usa um <code>EntityManager</code> para persistir um objeto de negócio no BD. O tipo de objeto de negócio é definido utilizando Generics, como feito na interface <code>DAO</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.manoelcampos.server.dao;

import com.manoelcampos.server.model.Cadastro;
import javax.persistence.EntityManager;
import javax.persistence.Query;
import javax.persistence.TypedQuery;

public class JpaDAO&lt;T extends Cadastro&gt; implements DAO&lt;T&gt; {
    private final EntityManager em;
    private final Class&lt;T&gt; classe;

    public JpaDAO(EntityManager em, Class&lt;T&gt; classe){
        this.em = em;
        this.classe = classe;
    }

    @Override
    public T findById(long id) {
        return em.find(classe, id);
    }

    @Override
    public boolean delete(T entity) {
        em.remove(entity);
        return true;
    }

    @Override
    public boolean delete(long id) {
        T entity = findById(id);
        return delete(entity);
    }

    @Override
    public long save(T entity) {
        if(entity.getId() &gt; 0)
            em.merge(entity);
        else em.persist(entity);

        return entity.getId();
    }

    @Override
    public T findByField(String fieldName, Object value) {
        final String jpql = "select o from " + classe.getSimpleName() + " o " +
                            " where o." + fieldName + " = :" + fieldName;
        TypedQuery&lt;T&gt; query = em.createQuery(jpql, classe);
        query.setParameter(fieldName, value);
        return query.getSingleResult();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como pode ser observado acima, os métodos para fazer a manipulação dos dados no BD são extremamente simples.
Alguns métodos merecem maiores esclarecimentos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>o método <code>save()</code> pode tanto inserir ou alterar um objeto no BD. Assim, precisamos saber qual dessas duas operações deve ser realizada. Uma forma simplória (para não complicar as coisas aqui) de fazer isso é verificar se o objeto (parâmetro <code>entity</code>) possui um valor pro atributo <code>id</code>, ou seja, se tal atributo tem valor maior que zero.
Neste caso, isto indica que o objeto já existe no BD e precisamos fazer um update chamando o método <code>em.merge(entity)</code>. Caso contrário, chamamos o <code>em.persist(entity)</code> pra incluir o objeto no BD.</p>
</li>
<li>
<p>o método <code>delete()</code> possui duas versões: uma que recebe a entidade (objeto) a ser excluído e outra que recebe apenas o id do objeto. Na JPA, para excluir um objeto do banco, precisamos ter uma instância de tal objeto. Usando o método que recebe apenas o id, teremos que primeiro localizar o objeto no banco e então excluir tal objeto. Como no serviço REST o mais fácil é passarmos apenas o id do objeto a ser excluído, é mais simples usar a versão do método que recebe apenas o id.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Já a instanciação de um <code>JpaDAO</code> não é tão simples assim. Para criar tal objeto é preciso passar dois parâmetros para o construtor. Sempre que precisarmos instanciar um <code>JpaDAO</code>, precisaremos passar estes parâmetros. É nesses casos em que a injeção de dependências tem mais valor.</p>
</div>
<div class="paragraph">
<p>Quando usamos injeção de dependência com CDI, objetos podem ser criados automaticamente, desde que eles tenham um construtor padrão. Como a classe <code>JpaDAO</code> (que é a única implementação da interface <code>DAO</code>) não possui um construtor padrão, não podemos injetar objetos <code>DAO</code> diretamente. Precisamos criar um código adicional para indicar ao CDI como objetos <code>DAO</code> devem ser criados, até porque se tivessemos mais de uma implementação da interface <code>DAO</code>, o CDI não saberia qual classe concreta instanciar para injetar um objeto que implementa tal interface.</p>
</div>
<div class="paragraph">
<p>A grande vantagem é que, apesar de termos um trabalho adicional para informar ao CDI como criar DAOs, teremos que fazer isso em um único lugar, ao invés de ter que passar esses parâmetros para criar um DAO em todo lugar que declararmos um. Para fazer isso, vamos alterar a classe <code>Producers</code> como abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.manoelcampos.server.config;

import com.manoelcampos.server.dao.DAO;
import com.manoelcampos.server.dao.JpaDAO;
import com.manoelcampos.server.model.Cadastro;
import java.lang.reflect.ParameterizedType;
import javax.enterprise.inject.Produces;
import javax.enterprise.inject.spi.InjectionPoint;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

public class Producers {
    @Produces
    @PersistenceContext
    private EntityManager em;

    @Produces
    public &lt;T extends Cadastro&gt; DAO&lt;T&gt; getDao(InjectionPoint ip){
        ParameterizedType t = (ParameterizedType) ip.getType();
        Class classe = (Class) t.getActualTypeArguments()[0];
        return new JpaDAO(em, classe);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Neste caso, definimos um método anotado com <code>@Produces</code>. Isto é necessário pois o CDI não sabe como instanciar um <code>DAO</code>, uma vez que esta é uma classe que nós criamos. Por mais que um <code>EntityManager</code> seja ainda mais complexo de ser criado, o CDI já tem recursos para instanciar tais objetos pra nós.
O método <code>getDao</code> então será chamado automaticamente, toda vez que um objeto <code>DAO</code> anotado com <code>@Inject</code> precisar ser criado. Lembre que o <code>@Inject</code> indica que um objeto deve ser injetado alí.</p>
</div>
<div class="paragraph">
<p>O parâmetro <code>ip</code> que tal método recebe, conterá informações sobre o local onde foi solicitada a injeção do <code>DAO</code>. Para declarar um <code>DAO</code> (por exemplo, para manipular objetos <code>Usuario</code>) temos que escrever <code>@Inject DAO&lt;Usuario&gt; dao</code>. A classe entre &lt; e &gt; indica quais objetos de negócio o <code>DAO</code> manipulará. Este parâmetro <code>ip</code> conterá informações como qual tipo genérico (definido entre &lt; e &gt;) está associado ao <code>DAO</code>. Com isto, conseguimos obter a classe entre &lt; e &gt; e assim criar um <code>DAO</code> instanciando um objeto <code>JpaDAO</code> para manipular objetos de tal classe. Como tal objeto também requer um <code>EntityManager</code>, podemos simplesmente acessar o atributo <code>em</code> declarado dentro da própria classe <code>Producers</code>. Quando fizermos isso, um <code>EntityManager</code> será produzido e passado para o <code>JpaDAO</code> criado.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configurando_o_servidor_rest">4.8. Configurando o Servidor REST</h3>
<div class="paragraph">
<p>Para criarmos e executarmos nossos serviços REST, precisamos habilitar o uso de REST no projeto. Para isto, basta criar uma classe como <code>RestConfig</code> no pacote <code>com.manoelcampos.server.config</code> (o nome da classe e do pacote podem ser qualquer um). Tal classe deve extender <code>javax.ws.rs.core.Application</code> e deve ser anotada com <code>@javax.ws.rs.ApplicationPath("api")</code>, onde <code>api</code> pode ser qualquer nome que indica a raiz a partir da qual os seviços REST estarão disponíveis. Tal classe não precisa ter métodos, construtor nem atributo algum, como mostrado abaixo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.manoelcampos.server.config;

import javax.ws.rs.core.Application;

@javax.ws.rs.ApplicationPath("api")
public class RestConfig extends Application {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Uma vez que estamos rodando o GlassFish localmente e que nosso projeto chama <code>server</code>, a URL para acessar a aplicação seria <a href="http://localhost:8080/server/" class="bare">http://localhost:8080/server/</a>.</p>
</div>
<div class="paragraph">
<p>Ao executar o projeto, uma página como <a href="http://localhost:8080/server/" class="bare">http://localhost:8080/server/</a> será acessada. A API REST estará disponível a partir de outro diretório, como especificado na anotação <code>@javax.ws.rs.ApplicationPath</code>. Neste caso, a URL base para acesso aos recursos será <a href="http://localhost:8080/server/api" class="bare">http://localhost:8080/server/api</a>. Mas não adianta tentar acessar tal URL, pois ela por si só não funciona: precisamos implementar nosso primeiro serviço que vai ser acessar a partir de um caminho adicional depois de tal URL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementando_o_servidor_rest">4.9. Implementando o Servidor REST</h3>
<div class="paragraph">
<p>O serviço REST que vamos implementar vai fornecer as famosas operações CRUD (Create, Read, Update e Delete)
que permite inserir (Criar), obter (Ler), alterar (Atualizar) e deletar registros de uma tabela de um BD.
Como pode ser visto <a href="../webservices.pptx">nesta apresentação</a>, em serviços REST, tais métodos CRUD devem ser associados a determinados métodos HTTP. A tabela abaixo a associação entre verbos HTTP, operações CRUD e comandos SQL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verbo (Método) HTTP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Operação CRUD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Comando SQL</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C</strong>reate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">insert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>R</strong>ead</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>U</strong>pdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>D</strong>elete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Assim, para cada método a ser implementado na classe do serviço em Java, precisamos indicar qual o verbo HTTP que deve ser usado para acessar o método remotamente.</p>
</div>
<div class="sect3">
<h4 id="_criando_a_classe_do_primeiro_serviço_rest">4.9.1. Criando a classe do primeiro serviço REST</h4>
<div class="paragraph">
<p>Toda a infraestrutura da nossa aplicação está pronta. Agora, vamos criar nosso Web Service (WS) REST. Tal WS disponibilizará operações para manipular usuários no BD, assim como as operações definidas no <code>DAO</code>. Web Services REST são acessados normalmente por meio de URLs amigáveis. Cada URL permite realizar operações sobre um determindao recurso, por meio de requisições utilizando os verbos do protocolo HTTP. Cada uma destas URLs é chamada de <em>endpoints</em>, que no código Java representam métodos a serem acessados remotamente por meio de requisições HTTP.</p>
</div>
<div class="paragraph">
<p>Na terminologia REST, um recurso pode ser um arquivo qualquer, uma imagem, dados obtidos de uma tabela em um BD (como é o nosso caso), etc. Assim, para podermos disponibilizar as operações do <code>DAO</code> para objetos <code>Usuario</code>, precisamos criar uma classe <code>UsuarioResource</code> no pacote <code>com.manoelcampos.server.rest</code>, como abaixo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.manoelcampos.server.rest;

import com.manoelcampos.server.dao.DAO;
import com.manoelcampos.server.model.Usuario;
import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

@Path("/usuario")
public class UsuarioResource {
    @Inject
    private DAO&lt;Usuario&gt; dao;

    @GET
    @Path("{id}")
    @Produces(MediaType.APPLICATION_JSON)
    public Usuario findById(@PathParam("id") long id) {
        return dao.findById(id);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para publicar tal classe como um recurso acessível via HTTP, precisamos incluir a anotação <code>@Path</code> antes da declaração da classe e indicar o caminho que será utilizado para acessar tal recurso por meio de uma URL. Neste caso, indicamos que um recurso <code>Usuario</code> poderá ser acessado a partir do caminho <code>/usuario</code>. O acesso ao recurso só acontece quando um determinado método da classe é executado. Cada método então define um caminho adicional a partir de <code>/usuario</code> que permitirá que o método seja chamado por uma requisição HTTP. No caso do método <code>findById</code> (que possui o mesmo nome que no <code>DAO</code>), ele será acessado a partir de <code>/usuario/{id}</code>, onde <code>{id}</code> representa o id do usuário que deseja-se obter.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A URL para acesso a um determinado método é formada pela:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URL base da aplicação, normalmente <a href="http://localhost:8080/NomeDaAplicacao" class="bare">http://localhost:8080/NomeDaAplicacao</a></p>
</li>
<li>
<p>mais o caminho (<code>@Path</code>) base do serviço REST, definido na classe <code>RestConfig</code> como <code>api</code></p>
</li>
<li>
<p>mais o caminho da classe do serviço</p>
</li>
<li>
<p>mais o caminho do método a ser acessado</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assim, a URL completa para acesso ao método <code>findById()</code> da classe <code>UsuarioResource</code> seria algo como <a href="http://localhost:8080/server/api/usuario/{id}" class="bare">http://localhost:8080/server/api/usuario/{id}</a>, onde {id} deve ser substituído pelo id do usuário que deseja-se obter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Observe que o método <code>findById</code> possui um parâmetro id. Quando utilizamos a anotação <code>@Path</code> para indicar qual o caminho a ser utilizado para acessar tal método via HTTP, definimos o nome como <code>{id}</code> (entre chaves), para indicar que <code>id</code> deve ser um valor a ser passado na URL após <code>/usuario</code>. Esta valor será passado automaticamente para o parâmetro id do método, uma vez que utilizamos a tag <code>@PathParam</code> para indicar isso. Note que no <code>@PathParam</code> não se usa chaves. Assim, se acessarmos uma URL terminada em <code>/usuario/1</code>, estamos querendo obter o usuário de id igual a 1. Assim, o valor para o parâmetro <code>id</code> é obtido a partir da URL e passado para o parâmetro id no método.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Certifique-se de incluir a anotação <code>@PathParam</code> correta, do pacote <code>javax.ws.rs</code>. Como existe uma anotação de mesmo nome no pacote <code>javax.websocket.server</code>, incluir esta vai causar o erro <em>"The request entity cannot be empty"</em>. Tal erro indica que o parâmetro anotado com a <code>@PathParam</code> incorreta não recebeu o valor passado pela URL (como especificado na anotação <code>@Path</code> do método <code>findById()</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Este método está anotado com <code>@Produces</code>, para indicar que o retorno do método deve ser convertido para JSON.
Esta anotação não é a mesma <code>@Produces</code> vista anteriormente para o CDI. Apesar de ter o mesmo nome, a finalidade é outra.
A anotação <code>@Produces</code> do JAX-RS é usada para indicar que formato deve ser usado para converter os dados retornados por um método. Como o mais usual em serviços REST é o formato JSON, usamos tal anotação para que o JAX-RS faça a conversão do objeto usuário retornado pelo método <code>findById()</code> para JSON.
Assim, tenha certeza de importar a anotação <code>@Produces</code> do pacote <code>javax.ws.rs.Produces</code> e não a anotação do CDI.</p>
</div>
<div class="paragraph">
<p>Por fim, também anotamos o método <code>findById()</code> com <code>@GET</code> para indicar que este método só aceita requisições HTTP com o verbo GET. Se utilizarmos um verbo que o método não aceita, receberemos o erro <em>"405 Method Not Allowed</em>", ou seja "Erro HTTP 405: Método (Verbo) não Permitido".</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementando_método_para_inserir_usuário">4.9.2. Implementando método para inserir usuário</h4>
<div class="paragraph">
<p>Definimos que o método <code>findById()</code> será acessado remotamente por meio do verbo GET do HTTP. Assim, estamos implementando a operação Read do CRUD. Como já temos o DAO implementando as operações CRUD, é bastante simples disponibilizar tais operações no nosso serviço REST. Vamos começar adicionando o método insert na classe <code>UsuarioResource</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@POST
@Consumes(MediaType.APPLICATION_JSON)
public long insert(Usuario usuario) {
    return dao.save(usuario);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>De acordo com a tabela mostrada anteriormente, para inserir um registro no banco (operação Create do CRUD), devemos usar o verbo POST do HTTP, anotando o método <code>insert()</code> com <code>@POST</code>. Neste caso, não incluímos uma anotação <code>@Path</code> pois não queremos que seja utilizado um caminho adicional, além do já existente <code>/usuario</code>, para inserir um usuário no banco. Se acessarmos tal URL por meio do verbo POST, o servidor REST entenderá que queremos chamar o método <code>insert()</code> mostrado acima.
Neste caso, como vamos passar um usuário a ser inserido no banco, o parâmetro do <code>insert()</code> é um objeto da classe <code>Usuario</code> e não um id numérico.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Tenha certeza de importar a anotação <code>@POST</code> correta, do pacote <code>javax.ws.rs</code>. Importando outra anotação que possa aparecer nas opções do IDE irá fazer com que o projeto não compile.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>No caso de requisições POST, os dados passados não vão na URL (como no verbo GET). Assim, não usamos a anotação <code>@PathParam</code> no parâmetro do método e nem incluímos parâmetro algum na anotação <code>@Path</code>. Até porque, neste exemplo não quisemos definir um caminho adicional para acessar o método, logo, não precisamos da <code>@Path</code>.</p>
</div>
<div class="paragraph">
<p>Observe que anotamos o método <code>insert()</code> com <code>@Consumes</code> e não <code>@Produces</code>, pois este método consome (recebe) dados em formato JSON, no lugar de produzir (retornar) dados em JSON. Como o método está retornando um tipo primitivo (o id do usuário inserido), não precisamos converter o retorno para JSON. Assim, o método apenas consome JSON.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Uma dica fácil para saber qual anotação usar é:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>quando o método recebe um objeto, ele vai consumir (<code>@Consumes</code>);</p>
</li>
<li>
<p>quando retorna um objeto ele vai produzir (<code>@Produces</code>).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_executando_a_aplicação">4.10. Executando a aplicação</h3>
<div class="paragraph">
<p>Antes de acessar uma URL de um método de um serviço REST implementado, precisamos clicar no botão <code>Build</code> para compilar todo o projeto. Sempre que salvamos o projeto, as classes alteradas são compiladas e o projeto é reimplantado (<em>redeployed</em>) automaticamente. Normalmente, como fizemos inúmeras alterações no projeto e nunca executamos o mesmo, é aconselhável clicar no botão <code>Clean and Build</code> (Limpar e Construir) para apagar quaisquer versões anteriores das classes compiladas e implantar as novas. Muitos erros ocorrem quando fazemos alterações estruturais no projeto (como mudar nome de classes e métodos, remover métodos, mudar parâmetros, etc) e não usamos tal botão. Agora, podemos clicar no botão <code>Play</code> (F6) para executar o projeto. Sem isso, o WS REST não poderá ser acessadso.</p>
</div>
<div class="paragraph">
<p>Ao executar o projeto, uma página como <a href="http://localhost:8080/server/" class="bare">http://localhost:8080/server/</a> será exibida, apenas pelo fato de um arquivo index.html ser criado automaticamente quando criamos o projeto. Então, esta página de fato não exibirá nada. A API REST estará disponível a partir de um caminho adicional. Já sabemos que a URL base dos serviços REST será <a href="http://localhost:8080/server/api/PathDeUmRecurso/PathDeUmMetodo" class="bare">http://localhost:8080/server/api/PathDeUmRecurso/PathDeUmMetodo</a>.</p>
</div>
<div class="paragraph">
<p>Então, para acessar o método <code>findById</code> do recurso <code>Usuario</code>, a URL completa seria algo como <a href="http://localhost:8080/server/api/usuario/1" class="bare">http://localhost:8080/server/api/usuario/1</a>.</p>
</div>
<div class="paragraph">
<p>Se uma classe como a <code>RestConfig</code> (mostrada no início da seção) não foi criada, o NetBeans dará um aviso na linha da declaração de qualquer classe anotada com <code>@Path</code> e permitirá adicionar a classe de configuração automaticamente. Esta é uma forma simples de não precisarmos ter que lembrar como deve ser esta classe <code>RestConfig</code>. Apenas lembre que a classe não precisa ter método algum.</p>
</div>
<div class="paragraph">
<p>Usando este assistente do NetBeans, ele adicionará código dentro de tal classe que de fato não funcionará (pelo menos não para as versões de bibliotecas e ferramentas utilizadas). Assim, se usar tal assistente para criar a classe, apague qualquer método e atributo adicionado. Lembre também de definir o nome pelo qual deseja acessar os recursos por meio de REST, dentro da anotação <code>@ApplicationPath()</code>. No nosso caso definimos o caminho como <em>"api"</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testando_o_serviço_criado">5. Testando o serviço criado</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para testar o serviço REST, podemos desenvolver uma aplicação cliente em qualquer linguagem que desejarmos,
para qualquer plataforma (web, mobile, desktop). O projeto <a href="client">cliente</a> é um exemplo de uma aplicação
de linha de comando em Java que consome tal serviço.</p>
</div>
<div class="paragraph">
<p>Testar um método REST que usa o verbo HTTP GET é trivial: basta digitar a URL do método, passando os devidos parâmetros.
No entanto, quando um método usa outro verbo HTTP, não conseguimos testar desta forma.
Se você não quiser criar uma aplicação cliente apenas para testar o serviço, existem várias alternativas para isto.
A forma mais simples, que não requer instalação de nenhuma ferramenta adicional, é usando o
site <a href="https://postwoman.io" class="bare">https://postwoman.io</a></p>
</div>
<div class="sect2">
<h3 id="_usando_a_ferramenta_de_linha_de_comando_curl">5.1. Usando a ferramenta de linha de comando curl</h3>
<div class="paragraph">
<p>O curl é uma ferramenta que já vem instalada na maioria das distribuições Linux.
Abaixo mostro como usar o comando curl no terminal para enviar uma requisição HTTP para diferentes métodos
publicados por um serviço REST (como o serviço de usuários desenvolvido aqui).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Método</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verbo HTTP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Comando curl completo</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserir Usuário</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">curl -X POST -d '{"cpf": "99999999999", "nome": "João"}' -H "Content-Type: application/json" <a href="http://localhost:8080/server/api/usuario/" class="bare">http://localhost:8080/server/api/usuario/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buscar Usuário</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">curl <a href="http://localhost:8080/server/api/usuario/1" class="bare">http://localhost:8080/server/api/usuario/1</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alterar Usuário</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">curl -X PUT -d '{"id": 1, "cpf": "11111111111", "nome": "Maria"}' -H "Content-Type: application/json" <a href="http://localhost:8080/server/api/usuario/" class="bare">http://localhost:8080/server/api/usuario/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Excluir Usuário</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">curl -X DELETE <a href="http://localhost:8080/server/api/usuario/1" class="bare">http://localhost:8080/server/api/usuario/1</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Observe que ainda não implementamos os métodos para alterar e excluir usuários (verbos POST e PUT). <strong>No caso da operação de inserir usuários, se tentar acessá-la, verá que ocorrerá um erro. Isto será explicado na próxima seção.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para operações POST e PUT, é comum passarmos no corpo da mensagem HTTP o conteúdo a ser enviado na requisição.
Nos exemplos acima, é passado um objeto <code>Usuario</code> em formato JSON. Neste caso, precisamos incluir o cabeçalho
<code>Content-Type</code> para indicar que estamos enviando um conteúdo em JSON na requisição HTTP.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Observe que ao enviar conteúdo JSON, é preciso usar aspas duplas ao redor do nome de atributos e valores. Todo o código JSON deve ser envolvido em aspas simples, não o contrário. Se as aspas forem invertidas, o servidor indicará que o JSON é inválido.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_usando_extensões_para_navegadores_web">5.2. Usando extensões para navegadores Web</h3>
<div class="paragraph">
<p>Você também pode utilizar o próprio navegador para testar seus serviços REST. Assim, você terá uma interface web amigável e intuitiva, facilitando muito os testes. A seguir são exibidas opções para Firefox e Chrome.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para o Firefox você pode baixar o plugin <a href="https://addons.mozilla.org/pt-BR/firefox/addon/restclient/">RESTClient</a>.</p>
</li>
<li>
<p>Para o Google Chrome utilizo a excelente extensão <a href="https://chrome.google.com/webstore/detail/restlet-client-rest-api-t/aejoelaoggembcahagimdiliamlcdmfm/">Talend API Tester (antigo Restlet Client)</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A extensão <em>Talend API Tester</em> tem um recurso extremamente útil de permitir criar projetos e salvar diferentes requisições HTTP
dentro deste projeto. Assim, podemos facilmente reenviar tais requisições sem ter que configurá-las novamente.
Muitas vezes, apenas alteramos valores de parâmetros e pronto. A imagem abaixo apresenta um exemplo de um projeto
criado em tal ferramenta.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/restlet-client-chrome.png" alt="restlet client chrome"></span></p>
</div>
<div class="paragraph">
<p>Todos os dados usadas nos exemplos de envio de requisição utilizando o comando curl na seção anterior devem
ser utilizados para preencher os campos na tela da extensão que você estiver usando no seu navegador, incluindo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>o verbo HTTP;</p>
</li>
<li>
<p>o conteúdo do corpo da mensagem (como nos casos de POST e PUT)
e cabeçalho para indicar o formato de tal conteúdo (no nosso caso, JSON).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_testando_o_método_de_incluir_usuário">5.3. Testando o método de incluir usuário</h3>
<div class="paragraph">
<p>Se você tentar acessar o método <code>insert()</code> da classe <code>UsuarioResource</code> para incluir um usuário, verá que ocorre a exceção <em>javax.persistence.TransactionRequiredException</em>, provavelmente sem apresentar nenhuma mensagem de erro. Tal exceção indica que tentamos executar uma operação que exigia uma transação, mas esta não foi aberta. Neste caso, estamos falando de transações de banco de dados. Como estamos usando JPA, para fazer alguma operação que altera dados no banco, precisamos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>iniciar uma transação;</p>
</li>
<li>
<p>executar a(s) operação(ões);</p>
</li>
<li>
<p>se a(s) operação(ões) foi(foram) executada(s) com sucesso, devemos fazer um <em>commit</em> na transação para efetivamente confirmar as alterações no banco;</p>
</li>
<li>
<p>se ocorrer algum erro ocorreu, devemos fazer um <em>rollback</em> para desfazer qualquer operação que tenha sido feita depois que a transação foi iniciada.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Lembra que lá no início configuramos a tal da JTA (Java Transaction API)? Pois é, esta API permite que o servidor de aplicação (GlassFish no nosso caso) controle este ciclo de vida de transações apresentado acima. Assim, não temos que escrever código para definir tais passos. Com a JTA, podemos apenas usar uma simples anotação para indicar que queremos usar transações de banco de dados nas nossas classes de serviços REST e tudo funcionará automaticamente, feito mágica. Costumamos dizer que este tipo de recurso é <strong>automágico</strong> 🤣.</p>
</div>
<div class="paragraph">
<p>Então, para os métodos de inserção, alteração e exclusão funcionarem, podemos anotar a classe <code>UsuarioResource</code> com <code>@Transactional</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementando_método_para_alterar_e_excluir_usuário">5.4. Implementando método para alterar e excluir usuário</h3>
<div class="paragraph">
<p>Por fim, vamos adicionar o código na classe <code>UsuarioResource</code> para os métodos de alteração e exclusão de usuários, como mostrado a seguir.
O código dispensa comentários, pois todos os detalhes já foram explicados na implementação dos métodos anteriores.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@PUT
@Consumes(MediaType.APPLICATION_JSON)
public boolean update(Usuario usuario) {
    //Se retornou um id maior que 0, é porque o usuário foi salvo no BD
    return dao.save(usuario) &gt; 0;
}

@DELETE
@Path("{id}")
public boolean delete(@PathParam("id") long id) {
    return dao.delete(id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pronto, agora pode usar alguma das formas mostradas anteriormente para testar qualquer método do serviço REST implementado.
Espero que o tutorial tenha sido completo e esclarecedor.
Se encontrar algum erro, algo que ficou mal explicado ou que pode ser melhorado, basta criar uma nova issue <a href="https://github.com/manoelcampos/sd-webservices/issues">aqui</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_download_do_código_fonte">6. Download do código fonte</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O código fonte do projeto pode ser baixado como zip <a href="https://kinolien.github.io/gitzip/?download=/manoelcampos/sd-webservices/tree/master/4.4-ws-rest-cadastro">aqui</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-03-05 15:31:30 -0300
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>